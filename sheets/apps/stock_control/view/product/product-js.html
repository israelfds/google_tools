
<script>

    $(function() {
        google.script.run.withSuccessHandler(renderProductPage).productHtmlBuilded(productId);
    });

    function renderProductPage(html) {
    
       var productPage = $('#product');
       productPage.html(html);
       document.getElementById("save").addEventListener("click", save);
    }
    
    function getDataForm(){

        let id = $("#id").val();
        let name = $("#name").val();
        let qtd = $("#qtd").val();
        let ppuc = $("#ppuc").val();
        let ppuv = $("#ppuv").val();
        let description = $("#description").val();

        //todo pegar investment data
        let investmentsForm = $('div[id^="investment_"]');
        let investmentsList = [];

        for (let i = 0; i < investmentsForm.length; i++ ){

            investmentsList.push({
                "investment_id": investmentsForm[i].id.replace("investment_", ""),
                "partner_id": investmentsForm[i].children.partner_id.value,
                "value": investmentsForm[i].children.value.value
            })
        }

        return {
            "id": id,
            "name": name,
            "qtd": qtd,
            "ppuc": ppuc,
            "ppuv": ppuv,
            "description": description,
            "investment": investmentsList
        }
    }
    
    // function renderMessageResponse(typeAlert, message){
    //
    //    let msg = `<div class="alert alert-${typeAlert}" role="alert">
    //                   ${message}
    //               </div>`
    //
    //    let content = $('#message-box');
    //    content.html(msg);
    // }
    //
    // function cleanMessageBox(){
    //    var message = $('#message-box');
	//    message.html("");
    // }
    
     function save(){

        // cleanMessageBox()

        //todo validar informações REQUIRED
        let data = getDataForm();
        alert(JSON.stringify(data));

        google.script.run.withSuccessHandler().saveOrUpdateProduct(data);

     }

    
</script>


